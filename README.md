# Лабораторная работа #3

В рамках данной лабораторной работы необходимо написать на C\C++ без использования сторонних библиотек кросплатформенную (POSIX, Windows) программу, которая:
- При старте открывает лог-файл и пишет в него строку со своим идентификатором процесса и временем запуска.
- Запускает таймер и раз в 300 мс увеличивает счетчик на 1.
- Позволяет пользователю через интерфейс командной строки установить любое значение счетчика.
- Раз в 1 секунду пишет в лог-файл текущее время (дата, часы, минуты, секунды, миллисекунды), свой идентификатор процесса и значение счетчика.
- Раз в 3 секунды запускает 2 своих копии:
    - Копия 1 записывает в тот же лог файл строку со своим идентификатором процесса, временем своего запуска, увеличивает текущее значение счетчика на 10, 
    записывает лог файл время выхода и завершается.
    - Копия 2 записывает в тот же лог файл строку со своим идентификатором процесса, временем своего запуска, увеличивает текущее значение счетчика в 2 раза, через 2 секунды уменьшает значение счетчика в 2 раза, записывает в лог файл время выхода и завершается.
    - Если какая-либо копия к следующему циклу запуска еще не завершила свою работу, программа не запускает копию, а пишет в лог сообщение.
- Пользователь может запустить любое количество программ. В этом случае только одна из программ должна писать в лог текущее значение счетчика и порождать копии, но все запущенные программы должны модифицировать счетчик раз в 300 мс и по запросу пользователя.
## Описание
В [main.c](main.c) происходит запуск программы, при помощи захвата семафора (`/semaphore_master`) процесс пытается стать `главным`.

```
Главный процесс получает возможность писать в лог-файл и порождать копии.
Лог файл - log.txt
```

Значение счётчика хранится в разделяемой памяти, логика работы с памятью реализована в [shared_mem.c](shared_mem.c), работа с ней синхронизирована при помощи семафора.

Обработка копий программ происходит при помощи флагов при запуске `--copy1` и `--copy2`.

Логирование в файл реализовано в [log.c](log.c).

Для абстракции от конкретной ОС реализованы функции кроссплатформенной работы с семафорами и потоками в [sem.c](sem.c) и [threads.c](threads.c).


Если главный инстанс завершился при помощи сигнала прерывания (`CTRL+C`) то он освобождает семафор и обнуляет счётчик, другой запущенный процесс может захватить семафор и стать главным.
## Запуск

#### Windows
Актуализировать исходный код и собрать проект при помощи скрипта `build.cmd`
> ./build.cmd

Запустить программу при помощи `./build/lab3.exe`

#### Unix
Актуализировать исходный код и собрать проект при помощи скрипта `build.sh`:
> ./build.sh

Запустить программу при помощи `./build/lab3`
